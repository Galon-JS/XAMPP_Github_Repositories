// Generated by CoffeeScript 1.12.7
(function() {
  var async, listen, net, options, send, settings, tcp;

  net = require("net");

  async = require("async");

  settings = require("./settings");

  send = require("./send");

  listen = require("./listen");

  options = settings.options;

  tcp = net.connect(options.port, options.host, function() {
    if (options.verbose) {
      console.log("Connected to " + tcp.remoteAddress + ":" + tcp.remotePort);
    }
    return async.series([
      function(callback) {
        return send(tcp, callback);
      }, function(callback) {
        return tcp.write(".\n", callback);
      }, function(callback) {
        return listen(tcp, callback);
      }
    ], function(err, results) {
      if (err != null) {
        return console.error("" + err);
      }
      if (options.verbose) {
        return console.log("Done");
      }
    });
  });

  tcp.on("error", function(err) {
    console.error("" + err);
    return process.exit(1);
  });

  tcp.on("end", function() {
    if (options.verbose) {
      return console.log("Connection closed");
    }
  });

}).call(this);
